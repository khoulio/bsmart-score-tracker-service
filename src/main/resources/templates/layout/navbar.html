<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <nav th:fragment="navbar" class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <!-- Brand -->
            <a class="navbar-brand" href="/admin/dashboard">
                <i class="bi bi-trophy-fill me-2"></i>
                <strong>Score Tracker</strong>
            </a>

            <!-- Mobile Toggle Button -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navigation Links -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <!-- Dashboard -->
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/dashboard">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>

                    <!-- Competitions -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="competitionsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-trophy"></i> Compétitions
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="competitionsDropdown">
                            <li><a class="dropdown-item" href="/admin/competitions">
                                <i class="bi bi-list-ul"></i> Gérer les compétitions
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/admin/sync/competitions">
                                <i class="bi bi-cloud-download"></i> Synchroniser
                            </a></li>
                        </ul>
                    </li>

                    <!-- Phases -->
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/phases">
                            <i class="bi bi-calendar3"></i> Phases
                        </a>
                    </li>

                    <!-- Matches -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="matchesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-flag-fill"></i> Matches
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="matchesDropdown">
                            <li><a class="dropdown-item" href="/admin/matches">
                                <i class="bi bi-list-ul"></i> Tous les matches
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/admin/matches?status=IN_PLAY">
                                <i class="bi bi-broadcast text-danger"></i> En direct
                            </a></li>
                            <li><a class="dropdown-item" href="/admin/matches?status=SCHEDULED">
                                <i class="bi bi-clock text-primary"></i> Programmés
                            </a></li>
                            <li><a class="dropdown-item" href="/admin/matches?status=FINISHED">
                                <i class="bi bi-check-circle text-success"></i> Terminés
                            </a></li>
                        </ul>
                    </li>
                </ul>

                <!-- Right Side Items -->
                <ul class="navbar-nav">
                    <!-- Live Indicator -->
                    <li class="nav-item">
                        <span class="nav-link" id="liveMatchCount">
                            <span class="badge bg-danger pulse" id="liveCount">0</span>
                            <i class="bi bi-broadcast"></i> Live
                        </span>
                    </li>

                    <!-- API Documentation -->
                    <li class="nav-item">
                        <a class="nav-link" href="/swagger-ui.html" target="_blank">
                            <i class="bi bi-code-slash"></i> API
                        </a>
                    </li>

                    <!-- Monitoring -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="monitoringDropdown" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-gear-fill"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="monitoringDropdown">
                            <li><a class="dropdown-item" href="/actuator/health" target="_blank">
                                <i class="bi bi-heart-pulse text-success"></i> Health
                            </a></li>
                            <li><a class="dropdown-item" href="/actuator/metrics" target="_blank">
                                <i class="bi bi-graph-up text-info"></i> Metrics
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="http://localhost:8761" target="_blank">
                                <i class="bi bi-diagram-3 text-warning"></i> Eureka
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Script to update live match count -->
    <script th:inline="javascript">
        // Update live match count periodically
        function updateLiveCount() {
            fetch('/api/matches?status=IN_PLAY')
                .then(response => response.json())
                .then(data => {
                    const count = data.length;
                    document.getElementById('liveCount').textContent = count;
                    if (count > 0) {
                        document.getElementById('liveCount').classList.add('pulse');
                    } else {
                        document.getElementById('liveCount').classList.remove('pulse');
                    }
                })
                .catch(error => console.error('Error fetching live matches:', error));
        }

        // Update every 15 seconds
        updateLiveCount();
        setInterval(updateLiveCount, 15000);
    </script>
</body>
</html>
